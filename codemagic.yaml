workflows:
  ios-workflow:
    name: Flangapp PRO iOS without publication
    max_build_duration: 30
    environment:
      vars:
        XCODE_WORKSPACE: "Runner.xcworkspace"
        XCODE_SCHEME: "Runner"
        APP_STORE_CONNECT_ISSUER_ID: 6TVX9G68UR
        APP_STORE_CONNECT_KEY_IDENTIFIER: 9UCR8LTRDF
        APP_STORE_CONNECT_PRIVATE_KEY: |-
         -----BEGIN PRIVATE KEY-----
         MIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgLP1/4wmXafTEyw1Y
         8zSafm+fzxJ0JEy595m4C8rgSsWgCgYIKoZIzj0DAQehRANCAATDGrfrm3ulmiF6
         7SC0iaPWNMBtYyELXygDOIOtZgMbVfXWjXr3u9+oQNBytot8m7qvbsj5pKFM9+7o
         SBj3E0p5
         -----END PRIVATE KEY-----

        CERTIFICATE_PRIVATE_KEY: |-
         -----BEGIN RSA PRIVATE KEY-----
         MIIEpAIBAAKCAQEAtJaWyU1OshVUrcae1zm3W4gExcFrnIp4zdoLvjfzMIPrxvcv
         GugNw3SmSPtxbvAfkcdk5c4XemyKZVByoq7yMW0ykzPEG3HVTBY0T78R034+x0nf
         BIlsuMqUOwftfTx4l+rvG0lZ6I8pC9K6EoqY4Z9KM81CHm2lONt7mLUcs1UKq8oh
         BIwO9oOvwe0P31yO0CfgoQuO5teAt3T2FzBmyMG8OiFEgNMYGQpbWq+6KmVBwl/Y
         v017cGdJ4dZ0OV56ym7Eh6B8K8TPXs3YeIhfZIF/28Qni7dJSaMMTYccm5KUFMt7
         hPxTkXJ5ZQCANSVV9KHbpD1GhxeUbag3vOMzGQIDAQABAoIBAAhFeHkWaSMXfoYq
         GYbmnhsbZwqOwijMn91f3hdTlTg05qT5l+b913mLG32uxKKN7Yg+D4VGFAW3uHwM
         +/8vD6lLZNxgq9wM8fXW84Tujbi36NS0cbpRuBDbuH/erFZG4YglytdfW/aergTc
         XUjxn7B/3QRz45IkuANbbDURoJOnHtRJGH+aYboRnVZyVXM21dA+98Mt/mfp8ag6
         Oujr3TLmA9GfCV4OrGTiUkzi/9HZi/YcPNwgQ+F1or7p1wSo3bW22Nj9k1b715mk
         MQYDGnFt7YgyfFw2Go5M7Pv6QZd3KxQ8es0IU7LURAx80SeP9PUQcpPwJWs/XrcY
         LHwrjG0CgYEAuEPjTRfRUVaTXvNGjfmOQJ1jxsNMWV3uY9GUK+gydHDSVN7EA0/d
         jovZUmIqbzgzyGF7v0DSjof6rd23UH3ejJOLtoumn/M0aki8NcCnrscq0YxKCAK+
         UTQlRAOmgwzIzgoWSC0ySq6XuYvucMI+mIqAdac6quxabJeaM0vS170CgYEA+uRA
         ZN5ZGwO2dW5qIqypsfOswQJrF0Ra+1MCD1thSrI7dUoFejzqqvTbTy8eh53sU0O/
         66pu5l1TSLYO+/KaUMud3PBR7hUyz2+tU/vxywdFlbeAC6WsbPOzBIdC0b2hHGDW
         133QlPN84kfoc38sM6MbpqSdr9jX5Ssy1O5B4I0CgYEAlO8ySn6kzfSHGyjQ7zI1
         W16bZe02ycjVRVMBS1fbaChEqRqBHhgwgOXiWudDWy/3EtBQQC55wYCBCoT5hRKn
         jcI4G+zWWdQumnV9woicP/V1U3fr4nutLl9Se53juWrc50RZ7C6zxo9FzVAgAn3O
         MGdKG052ae6ty7XhifKQUZUCgYEA2EbRF+Lwry/5JqwDBFcRhdyILG3YQVtkjsiU
         uwZMDWctiENCC4jdxneDYnQ8/i1t3q1FkXL/XMhQlhqTOi99RW7xa9ci2XkeruEX
         apGCc0GWg6SG1gOAav99b8bmHAY7D0qPiX3kw7JOEoZoZL/ZK75MhM/dOwxTuDMQ
         A6xLz7UCgYBV+fAyrGMrHewYmcic3CQUn7BFLMrijysMJbr3Fpcdmub+4fhUrigP
         tPYm72JUj80JU4hlIS9EJONgKb2DqzAgmS76HMFUV60q//I0VwN9SRl3CywVWv3m
         JBy8MWpjjBx4Borv9CFt5W+92UWPTFGTLbPWYU4jM+nAz7tolsrZnQ==
         -----END RSA PRIVATE KEY-----
         

        BUNDLE_ID: "msk.sovetdoma.app"
      flutter: 3.16.7
      xcode: latest
      cocoapods: default
    scripts:
      - name: Set up keychain to be used for codesigning using Codemagic CLI 'keychain' command
        script: |
          keychain initialize
      - name: Fetch signing files
        script: |
          app-store-connect fetch-signing-files $BUNDLE_ID --type IOS_APP_STORE --create --log-api-calls --verbose
      - name: Use system default keychain
        script: |
          keychain add-certificates
      - name: Set up code signing settings on Xcode project
        script: |
          xcode-project use-profiles
      - name: Get Flutter packages
        script: |
          cd . && flutter packages pub get
      - name: Install pods
        script: |
          find . -name "Podfile" -execdir pod install \;
      - name: Flutter build ipa and automatic versioning
        script: |
          flutter build ipa --release --no-tree-shake-icons \
          --build-name=1.0.0 \
          --build-number=1 \
          --export-options-plist=/Users/builder/export_options.plist
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - flutter_drive.log
    publishing:
      scripts:
        - name: HTTP notification
          script: |
            curl https://flangapi.impeltech.ru:8443/public/observe/notice?uid=e971405c-23c2-274c-c419-ea43dd59f8fb